import{d as H,u as J,c as C,a as s,w as t,h as n,b as T,e as _,r as i,g as h,t as d,j as g,F as K,l as Q,i as S,k as P,f as p}from"./index-BWLevX4m.js";import{u as X,a as Y}from"./configStore-B2mf_68t.js";const Z={class:"pa-4"},ee={class:"va-h1 mb-6"},le={class:"d-flex align--center"},ae={key:0,class:"mt-2"},ne=H({__name:"ProviderConfig",setup(oe){const{t:l}=J(),u=X(),k=T(()=>u.providers),M=T(()=>u.loading),N=T(()=>[{key:"name",label:l("providers.name"),sortable:!0},{key:"providerType",label:l("providers.type"),sortable:!0},{key:"enabled",label:l("providers.enabled"),sortable:!0},{key:"settings",label:l("providers.settings"),sortable:!1},{key:"actions",label:l("common.actions"),sortable:!1}]),m=_(!1),f=_(!1),c=_(null),v=_(null),r=_({name:"",providerType:"pushdeer",enabled:!0,settings:{pushkey:""}}),$=["pushdeer"];function B(o,a){return o.includes("key")||o.includes("token")||o.includes("password")?"••••••••":a}function F(o){c.value=o,r.value={name:o.name||"",providerType:o.providerType,enabled:o.enabled!==!1,settings:{...o.settings}},m.value=!0}function x(){c.value=null,r.value={name:"",providerType:"pushdeer",enabled:!0,settings:{pushkey:""}}}function I(){if(c.value){const o=k.value.findIndex(a=>a.providerType===c.value.providerType);o!==-1&&(k.value[o]={...r.value})}else u.addProvider({...r.value});x(),m.value=!1,u.saveConfig()}function j(o){confirm(l("providers.confirmDelete"))&&(u.removeProvider(o.providerType),u.saveConfig())}async function E(o){try{v.value=await Y.testNotification(u.userId,{providerType:o.providerType,title:l("providers.test"),body:"This is a test notification from Vikunja Webhook System"}),f.value=!0}catch(a){v.value={success:!1,errorMessage:a.message||l("providers.testFailed"),timestamp:new Date().toISOString()},f.value=!0}}return(o,a)=>{const b=i("va-button"),O=i("va-icon"),A=i("va-avatar"),w=i("va-chip"),D=i("va-button-group"),L=i("va-data-table"),R=i("va-inner-loading"),z=i("va-input"),W=i("va-select"),q=i("va-switch"),U=i("va-modal"),G=i("va-alert");return p(),C("div",Z,[s(R,{loading:M.value},{default:t(()=>[h("h1",ee,d(n(l)("providers.title")),1),s(b,{onClick:a[0]||(a[0]=e=>m.value=!0),icon:"add",class:"mb-6"},{default:t(()=>[g(d(n(l)("providers.add")),1)]),_:1}),s(L,{items:k.value,columns:N.value,striped:"",hoverable:""},{"cell(name)":t(({rowData:e})=>[h("div",le,[s(A,{color:"primary",size:"small",class:"mr-2"},{default:t(()=>[s(O,{name:"notifications"})]),_:1}),h("strong",null,d(e.name||e.providerType),1)])]),"cell(enabled)":t(({rowData:e})=>[s(w,{color:e.enabled?"success":"secondary",size:"small"},{default:t(()=>[g(d(e.enabled?n(l)("providers.enabled"):n(l)("providers.disabled")),1)]),_:2},1032,["color"])]),"cell(settings)":t(({rowData:e})=>[(p(!0),C(K,null,Q(e.settings,(y,V)=>(p(),S(w,{key:V,size:"small",class:"mr-1"},{default:t(()=>[g(d(V)+": "+d(B(V,y)),1)]),_:2},1024))),128))]),"cell(actions)":t(({rowData:e})=>[s(D,{size:"small"},{default:t(()=>[s(b,{icon:"edit",onClick:y=>F(e)},null,8,["onClick"]),s(b,{icon:"send",onClick:y=>E(e)},null,8,["onClick"]),s(b,{icon:"delete",color:"danger",onClick:y=>j(e)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["items","columns"])]),_:1},8,["loading"]),s(U,{modelValue:m.value,"onUpdate:modelValue":a[5]||(a[5]=e=>m.value=e),title:c.value?n(l)("providers.edit"):n(l)("providers.add"),size:"medium",onOk:I,onCancel:x},{default:t(()=>[s(z,{modelValue:r.value.name,"onUpdate:modelValue":a[1]||(a[1]=e=>r.value.name=e),label:n(l)("providers.name"),class:"mb-4"},null,8,["modelValue","label"]),s(W,{modelValue:r.value.providerType,"onUpdate:modelValue":a[2]||(a[2]=e=>r.value.providerType=e),label:n(l)("providers.type"),options:$,disabled:!!c.value,class:"mb-4"},null,8,["modelValue","label","disabled"]),s(q,{modelValue:r.value.enabled,"onUpdate:modelValue":a[3]||(a[3]=e=>r.value.enabled=e),label:n(l)("providers.enabled"),class:"mb-4"},null,8,["modelValue","label"]),r.value.providerType==="pushdeer"?(p(),S(z,{key:0,modelValue:r.value.settings.pushkey,"onUpdate:modelValue":a[4]||(a[4]=e=>r.value.settings.pushkey=e),label:n(l)("providers.pushkey"),type:"password"},null,8,["modelValue","label"])):P("",!0)]),_:1},8,["modelValue","title"]),s(U,{modelValue:f.value,"onUpdate:modelValue":a[7]||(a[7]=e=>f.value=e),title:n(l)("providers.test"),size:"small","hide-default-actions":""},{footer:t(()=>[s(b,{onClick:a[6]||(a[6]=e=>f.value=!1)},{default:t(()=>[g(d(n(l)("common.close")),1)]),_:1})]),default:t(()=>[v.value?(p(),S(G,{key:0,color:v.value.success?"success":"danger",border:"top"},{default:t(()=>[g(d(v.value.success?n(l)("providers.testSuccess"):n(l)("providers.testFailed"))+" ",1),v.value.errorMessage?(p(),C("div",ae,d(v.value.errorMessage),1)):P("",!0)]),_:1},8,["color"])):P("",!0)]),_:1},8,["modelValue","title"])])}}});export{ne as default};
