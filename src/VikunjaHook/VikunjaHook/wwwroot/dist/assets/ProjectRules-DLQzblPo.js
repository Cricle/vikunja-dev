import{d as H,u as J,o as K,c as b,g,t as c,h as i,a as l,w as n,e as k,r as s,j as _,F as y,l as I,b as h,f as v,i as P,k as Q}from"./index-BWLevX4m.js";import{u as T}from"./configStore-B2mf_68t.js";import{u as W}from"./eventStore-CyV9OD7O.js";import{v as X}from"./vikunjaApi-BsdAWamU.js";const Y={class:"pa-4"},Z={class:"va-h1 mb-6"},ee={class:"d-flex align--center"},oe={class:"row row-equal mb-4"},ce=H({__name:"ProjectRules",setup(te){const{t:a}=J(),j=T(),x=W(),E=h(()=>j.projectRules),S=h(()=>x.allEvents),m=k(!1),u=k(""),C=k([]),V=k([]),w=h(()=>{const o=E.value.map(e=>e.projectId);return V.value.filter(e=>!o.includes(String(e.id)))});function R(o){if(o==="*")return a("projects.allProjects");const e=V.value.find(r=>String(r.id)===o);return e?e.title:`Project ${o}`}function N(o){return x.getEventMetadata(o).label}function U(o,e,r){const d=E.value.find(p=>p.projectId===o);d&&(r?d.enabledEvents.includes(e)||d.enabledEvents.push(e):d.enabledEvents=d.enabledEvents.filter(p=>p!==e))}function B(){u.value&&(j.addProjectRule({projectId:String(u.value),enabledEvents:[],providerType:void 0}),m.value=!1,u.value="")}function F(){m.value=!1,u.value=""}function z(o){confirm(a("projects.confirmDelete"))&&j.removeProjectRule(o)}async function M(){try{await j.saveConfig()}catch(o){console.error("Failed to save configuration:",o)}}return K(async()=>{try{V.value=await X.getProjects()}catch(o){console.error("Failed to load projects:",o)}}),(o,e)=>{const r=s("va-button"),d=s("va-icon"),p=s("va-chip"),$=s("va-checkbox"),A=s("va-divider"),D=s("va-collapse-item"),L=s("va-collapse"),q=s("va-select"),O=s("va-modal");return v(),b("div",Y,[g("h1",Z,c(i(a)("projects.title")),1),l(r,{onClick:e[0]||(e[0]=t=>m.value=!0),icon:"add",class:"mb-6"},{default:n(()=>[_(c(i(a)("projects.add")),1)]),_:1}),l(L,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t),multiple:""},{default:n(()=>[(v(!0),b(y,null,I(E.value,t=>(v(),P(D,{key:t.projectId,value:t.projectId,class:"mb-3"},{header:n(()=>[g("div",ee,[l(d,{name:"folder",class:"mr-3"}),g("strong",null,c(R(t.projectId)),1),l(p,{size:"small",color:"info",class:"ml-3"},{default:n(()=>[_(c(t.enabledEvents.length)+" "+c(i(a)("projects.enabledEvents")),1)]),_:2},1024)])]),content:n(()=>[g("div",oe,[(v(!0),b(y,null,I(S.value,f=>(v(),b("div",{class:"flex xs12 sm6 md4 lg3",key:f},[l($,{"model-value":t.enabledEvents.includes(f),"onUpdate:modelValue":G=>U(t.projectId,f,G)},{default:n(()=>[_(c(N(f)),1)]),_:2},1032,["model-value","onUpdate:modelValue"])]))),128))]),l(A,{class:"my-4"}),t.projectId!=="*"?(v(),P(r,{key:0,size:"small",color:"danger",icon:"delete",onClick:f=>z(t.projectId)},{default:n(()=>[_(c(i(a)("common.delete")),1)]),_:1},8,["onClick"])):Q("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),l(r,{onClick:M,color:"primary",icon:"save",class:"mt-6"},{default:n(()=>[_(c(i(a)("common.save")),1)]),_:1}),l(O,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=t=>m.value=t),title:i(a)("projects.add"),size:"medium",onOk:B,onCancel:F},{default:n(()=>[l(q,{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value=t),label:i(a)("projects.projectId"),options:w.value,"text-by":"title","value-by":"id",searchable:""},null,8,["modelValue","label","options"])]),_:1},8,["modelValue","title"])])}}});export{ce as default};
